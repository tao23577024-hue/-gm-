<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„åŸºé‡‘å®ç›˜ (æ·˜å®æºæé€Ÿç‰ˆ)</title>
    
    <script>
        window.onerror = function(msg, url, line, col, error) {
            var log = document.getElementById('error-log');
            if(log) {
                log.style.display = 'block';
                log.innerHTML += "é”™è¯¯: " + msg + "<br>ä½ç½®: " + line + ":" + col + "<br><br>";
            }
            // åªè¦å‡ºé”™ï¼Œå¼ºåˆ¶æ˜¾ç¤ºç•Œé¢ï¼Œé˜²æ­¢ç™½å±
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        };
    </script>

    <script src="https://registry.npmmirror.com/vue/3.3.4/files/dist/vue.global.prod.js"></script>
    <script src="https://registry.npmmirror.com/echarts/5.4.3/files/dist/echarts.min.js"></script>
    
    <style>
        /* --- åŸç”Ÿ CSS æ ·å¼ (æ— éœ€åŠ è½½å¤–éƒ¨ CSS æ–‡ä»¶) --- */
        :root {
            --bg-color: #0B0E14;
            --card-bg: #151b28; /*ç¨å¾®è°ƒäº®ä¸€ç‚¹å¡ç‰‡èƒŒæ™¯ï¼Œå¢åŠ å±‚æ¬¡*/
            --border-color: #2d3748;
            --text-main: #e2e8f0;
            --text-sub: #94a3b8;
            --accent-blue: #3b82f6;
            --up-color: #ef4444; /* é²œè‰³çº¢ */
            --down-color: #10b981; /* é²œè‰³ç»¿ */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
        }

        /* å¸ƒå±€ç³»ç»Ÿ Grid Layout - ä¸¥æ ¼æŒ‰ç…§ä½ çš„è®¾è®¡å›¾ */
        .app-layout {
            display: grid;
            grid-template-columns: 1fr 280px; /* å·¦ä¾§è‡ªé€‚åº”ï¼Œå³ä¾§èµ„è®¯æ å›ºå®š 280px */
            grid-template-rows: 80px 1fr 300px; /* é¡¶æ (å¤§ä¸€ç‚¹), åˆ—è¡¨, Kçº¿å›¾ */
            gap: 16px;
            padding: 20px;
            height: 100vh;
            max-width: 1920px;
            margin: 0 auto;
        }

        /* é€šç”¨å¡ç‰‡ */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* åœ†è§’ç¨å¾®å¤§ä¸€ç‚¹ */
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* 1. é¡¶éƒ¨æ•°æ®æ  (è“è‰²æ¡†åŒºåŸŸ) */
        .header {
            grid-column: 1 / 2; /* åªåœ¨å·¦ä¾§åŒºåŸŸ */
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 40px;
            background: linear-gradient(to bottom, #1a202c, #151b28);
        }
        
        .stat-block { text-align: center; }
        .stat-title { font-size: 13px; color: var(--text-sub); margin-bottom: 6px; }
        .stat-num { font-size: 28px; font-weight: bold; font-family: monospace; letter-spacing: 1px; }
        
        /* 2. åŸºé‡‘åˆ—è¡¨åŒº (é»„è‰²æ¡†åŒºåŸŸ) */
        .main-list {
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .search-wrapper { margin-bottom: 12px; position: relative; z-index: 50; }
        .search-input {
            width: 100%; background: #0f131a; border: 1px solid var(--border-color);
            color: white; padding: 10px 16px; border-radius: 6px; outline: none; font-size: 13px;
            transition: border-color 0.2s;
        }
        .search-input:focus { border-color: var(--accent-blue); }
        
        .search-dropdown {
            position: absolute; top: 100%; left: 0; width: 100%;
            background: #1e293b; border: 1px solid var(--border-color);
            max-height: 300px; overflow-y: auto; border-radius: 6px; margin-top: 4px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        .search-item {
            padding: 10px 16px; cursor: pointer; display: flex; justify-content: space-between; font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .search-item:hover { background: #334155; }

        /* ç½‘æ ¼ä¼˜åŒ–ï¼šå°å¡ç‰‡ */
        .fund-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* å®½åº¦è‡ªé€‚åº” */
            gap: 12px;
            overflow-y: auto;
            padding-right: 4px; /* æ»šåŠ¨æ¡é—´éš™ */
        }
        .fund-grid::-webkit-scrollbar { width: 6px; }
        .fund-grid::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        .fund-card {
            padding: 16px; 
            cursor: pointer; 
            transition: all 0.2s; 
            border: 1px solid transparent;
            background: #111827;
        }
        .fund-card:hover { border-color: #475569; transform: translateY(-1px); }
        .fund-card.active { 
            border-color: var(--accent-blue); 
            background-color: rgba(59, 130, 246, 0.08);
            box-shadow: 0 0 0 1px var(--accent-blue);
        }

        .f-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .f-name { font-size: 14px; font-weight: bold; color: #f1f5f9; width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .f-code { font-size: 11px; color: #64748b; margin-top: 2px; display: inline-block; background: #1e293b; padding: 1px 4px; border-radius: 3px; }
        .f-percent { font-size: 16px; font-weight: bold; font-family: monospace; }
        .f-label { font-size: 10px; color: #64748b; text-align: right; margin-top: 2px; }

        .f-bottom { 
            display: flex; justify-content: space-between; align-items: flex-end; 
            padding-top: 10px; border-top: 1px dashed #334155;
        }
        .f-val-label { font-size: 11px; color: #64748b; margin-bottom: 2px; }
        .f-val { font-size: 13px; font-family: monospace; color: #cbd5e1; }
        .f-input { 
            background: transparent; border: none; border-bottom: 1px solid #475569; 
            color: white; width: 70px; font-family: monospace; outline: none; font-size: 13px;
        }
        .f-input:focus { border-color: var(--accent-blue); }

        .btn-close { position: absolute; top: 4px; right: 4px; color: #475569; background: none; border: none; cursor: pointer; opacity: 0; }
        .fund-card:hover .btn-close { opacity: 1; }
        .btn-close:hover { color: var(--up-color); }

        /* 3. åº•éƒ¨ Kçº¿å›¾ (çº¢è‰²æ¡†åŒºåŸŸ) */
        .chart-box {
            grid-column: 1 / 2;
            display: flex; flex-direction: column;
            padding: 10px;
        }
        .chart-info { display: flex; justify-content: space-between; padding: 0 10px 5px; border-bottom: 1px solid #2d3748; margin-bottom: 5px; }
        #mainChart { flex: 1; width: 100%; min-height: 0; }

        /* 4. å³ä¾§èµ„è®¯ (ç»¿è‰²æ¡†åŒºåŸŸ) */
        .sidebar {
            grid-row: 1 / 4; /* å æ»¡å³ä¾§æ‰€æœ‰è¡Œ */
            display: flex; flex-direction: column;
        }
        .side-header { 
            padding: 15px; border-bottom: 1px solid var(--border-color); font-weight: bold; font-size: 14px; color: var(--accent-blue);
            display: flex; justify-content: space-between; align-items: center;
        }
        .news-container { flex: 1; overflow-y: auto; padding: 0 15px; }
        .news-item { padding: 15px 0; border-bottom: 1px solid #1e293b; }
        .news-time { font-size: 11px; color: #64748b; margin-bottom: 4px; font-family: monospace; }
        .news-txt { font-size: 13px; line-height: 1.5; color: #cbd5e1; transition: color 0.2s; cursor: pointer; }
        .news-txt:hover { color: var(--accent-blue); }

        /* è¾…åŠ©ç±» */
        .text-up { color: var(--up-color); }
        .text-down { color: var(--down-color); }
        .add-btn {
            border: 1px dashed #475569; color: #64748b; height: 100px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 8px;
            transition: all 0.2s;
        }
        .add-btn:hover { border-color: var(--accent-blue); color: var(--accent-blue); background: rgba(59,130,246,0.05); }

        /* å¼¹çª— */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 999; }
        .modal { background: #1e293b; padding: 24px; border-radius: 8px; width: 340px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }
    </style>
</head>
<body>

<div id="loading" style="position:fixed; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; transition: opacity 0.5s;">
    <div style="color:white; font-size:16px; margin-bottom:20px;">æ­£åœ¨è¿æ¥å›½å†…é«˜é€ŸèŠ‚ç‚¹...</div>
    <button id="force-btn" onclick="document.getElementById('loading').style.display='none';document.getElementById('app').style.display='block'" 
            style="display:none; padding:8px 20px; background:#333; color:#ccc; border:1px solid #555; border-radius:4px; cursor:pointer;">
        å¦‚æœé•¿æ—¶é—´å¡é¡¿ï¼Œç‚¹æ­¤å¼ºåˆ¶è¿›å…¥
    </button>
    <div id="error-log" style="display:none; color:#ff4444; font-size:12px; margin-top:20px; text-align:left; max-width:80%;"></div>
</div>

<script>
    // 3ç§’åæ˜¾ç¤ºå¼ºåˆ¶æŒ‰é’®
    setTimeout(function(){
        var btn = document.getElementById('force-btn');
        if(btn) btn.style.display = 'block';
    }, 3000);
</script>

<div id="app" style="display: none;">
    <div class="app-layout">
        
        <header class="card header">
            <div class="stat-block">
                <div class="stat-title">é¢„ä¼°ä»Šæ—¥æ”¶ç›Š</div>
                <div class="stat-num" :class="totalDailyProfit >= 0 ? 'text-up' : 'text-down'">
                    {{ totalDailyProfit >= 0 ? '+' : '' }}{{ totalDailyProfit }}
                </div>
            </div>
            
            <div style="width:1px; height:40px; background:var(--border-color)"></div>

            <div class="stat-block">
                <div class="stat-title">
                    æŒæœ‰æ€»é‡‘é¢
                    <span @click="togglePrivacy" style="cursor: pointer; margin-left:4px; font-size:12px;">
                        {{ settings.privacyMode ? 'ğŸ”’' : 'ğŸ‘ï¸' }}
                    </span>
                </div>
                <div class="stat-num" style="color: #f8fafc;">
                    {{ settings.privacyMode ? '****' : totalAmount }}
                </div>
            </div>

            <div style="width:1px; height:40px; background:var(--border-color)"></div>

            <div class="stat-block">
                <div class="stat-title">ä¸Šæ¬¡æ›´æ–°</div>
                <div class="stat-num" style="font-size:20px; margin-top:6px; color:#94a3b8;">
                    {{ lastUpdateTime }}
                </div>
            </div>

            <div style="position:absolute; right:20px; top:25px; display:flex; gap:10px;">
                 <button @click="manualRefresh" title="åˆ·æ–°" style="background:#3b82f6; color:white; border:none; width:32px; height:32px; border-radius:4px; cursor:pointer;">â†»</button>
                 <button @click="showSettings = true" title="è®¾ç½®" style="background:#334155; color:white; border:none; width:32px; height:32px; border-radius:4px; cursor:pointer;">âš™</button>
            </div>
        </header>

        <main class="main-list">
            <div class="search-wrapper">
                <input v-model="searchInput" @input="handleSearch" class="search-input" placeholder="è¾“å…¥ä»£ç  (å¦‚ 009052) æˆ–åç§°æ·»åŠ åŸºé‡‘...">
                <div v-if="searchResults.length" class="search-dropdown">
                    <div v-for="res in searchResults" @click="addFund(res)" class="search-item">
                        <span style="color:#e2e8f0">{{ res.NAME }}</span>
                        <span style="font-family:monospace; color:#94a3b8">{{ res.CODE }}</span>
                    </div>
                </div>
            </div>

            <div class="fund-grid">
                <div v-for="(fund, index) in funds" :key="fund.code" 
                     @click="selectFund(fund)"
                     class="card fund-card"
                     :class="{ 'active': selectedFundCode === fund.code }">
                    
                    <button @click.stop="removeFund(index)" class="btn-close">âœ•</button>

                    <div class="f-top">
                        <div>
                            <div class="f-name" :title="fund.name">{{ fund.name }}</div>
                            <span class="f-code">{{ fund.code }}</span>
                        </div>
                        <div>
                            <div class="f-percent" :class="fund.gszzl >= 0 ? 'text-up' : 'text-down'">{{ fund.gszzl }}%</div>
                            <div class="f-label">ä¼°ç®—æ¶¨å¹…</div>
                        </div>
                    </div>

                    <div class="f-bottom">
                        <div>
                            <div class="f-val-label">æŒä»“é‡‘é¢</div>
                            <div v-if="!settings.privacyMode">
                                <input type="number" v-model.number="fund.holdAmount" @click.stop @change="saveData" class="f-input" placeholder="0">
                            </div>
                            <div v-else style="font-size:13px; color:#475569">****</div>
                        </div>
                        <div style="text-align:right">
                            <div class="f-val-label">é¢„ä¼°æ”¶ç›Š</div>
                            <div class="f-val" style="font-weight:bold" :class="calcProfit(fund) >= 0 ? 'text-up' : 'text-down'">
                                {{ settings.privacyMode ? '***' : calcProfit(fund) }}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.05)">
                         <div>
                             <div class="f-val-label">å®æ—¶å‡€å€¼</div>
                             <div class="f-val">{{ fund.gsz }}</div>
                         </div>
                         <div style="text-align:right">
                             <div class="f-val-label">æ˜¨æ—¥å‡€å€¼</div>
                             <div class="f-val" style="color:#64748b">{{ fund.dwjz }}</div>
                         </div>
                    </div>
                </div>

                <div @click="$el.parentElement.previousElementSibling.querySelector('input').focus()" class="add-btn">
                    + æ·»åŠ 
                </div>
            </div>
        </main>

        <footer class="card chart-box">
            <div class="chart-info">
                <div style="font-weight:bold; color:#e2e8f0; font-size:14px;">
                    {{ getSelectedFundName() || 'ç‚¹å‡»ä¸Šæ–¹åŸºé‡‘æŸ¥çœ‹åˆ†æ—¶èµ°åŠ¿' }}
                    <span v-if="selectedFundCode" style="font-size:12px; color:#64748b; margin-left:10px;">{{ selectedFundCode }}</span>
                </div>
                <div style="font-size:12px; color:#64748b">æ‹–æ‹½ä¸‹æ–¹æ»‘å—æŸ¥çœ‹å†å²</div>
            </div>
            <div id="mainChart"></div>
        </footer>

        <aside class="card sidebar">
            <div class="side-header">
                <span>7x24 å¿«è®¯</span>
                <span style="font-size:10px; padding:2px 6px; background:rgba(16, 185, 129, 0.1); color:#10b981; border-radius:4px;">LIVE</span>
            </div>
            <div class="news-container">
                <div v-for="(news, i) in newsList" :key="i" class="news-item">
                    <div class="news-time">{{ news.time }}</div>
                    <div class="news-txt">{{ news.title }}</div>
                </div>
            </div>
        </aside>

    </div>

    <div v-if="showSettings" class="modal-overlay" @click.self="showSettings = false">
        <div class="modal">
            <h3 style="color:white; margin-bottom:20px;">ç³»ç»Ÿè®¾ç½®</h3>
            <div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                <span style="color:#cbd5e1; font-size:14px;">æ•°æ®æº</span>
                <select v-model="settings.dataSource" @change="manualRefresh" style="background:#0f131a; color:white; border:1px solid #334155; padding:4px 8px; border-radius:4px;">
                    <option value="eastmoney">å¤©å¤©åŸºé‡‘</option>
                    <option value="sina">æ–°æµªè´¢ç»</option>
                </select>
            </div>
            <div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                <span style="color:#cbd5e1; font-size:14px;">éšç§æ¨¡å¼</span>
                <input type="checkbox" v-model="settings.privacyMode" style="width:16px; height:16px;">
            </div>
            <button @click="showSettings = false" style="width:100%; padding:8px; background:#3b82f6; color:white; border:none; border-radius:4px; margin-top:10px; cursor:pointer;">ç¡®è®¤</button>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, nextTick } = Vue;

    createApp({
        setup() {
            const funds = ref([]);
            const selectedFundCode = ref(null);
            const searchInput = ref("");
            const searchResults = ref([]);
            const lastUpdateTime = ref("--:--");
            const showSettings = ref(false);
            const chartHistory = ref({}); 
            const settings = ref({ privacyMode: false, dataSource: 'eastmoney' });

            const newsList = ref([
                {time: '15:30', title: 'æ”¶ç›˜ï¼šåˆ›ä¸šæ¿æŒ‡æ¶¨è¶…1%ï¼ŒAIåº”ç”¨æ–¹å‘æ€æ¶¨åœæ½®'},
                {time: '14:45', title: 'åŒ—å‘èµ„é‡‘å…¨å¤©å‡€ä¹°å…¥è¶…50äº¿å…ƒ'},
                {time: '14:10', title: 'å…‰åˆ»æœºæ¦‚å¿µéœ‡è¡èµ°å¼ºï¼Œå¼ æ±Ÿé«˜ç§‘æ¶¨åœ'},
                {time: '13:20', title: 'æ¸¯è‚¡æ’ç”Ÿç§‘æŠ€æŒ‡æ•°åˆåæ¶¨å¹…æ‰©å¤§è‡³2%'},
                {time: '11:30', title: 'ç™½é…’æ¿å—æ¢åº•å›å‡ï¼Œè´µå·èŒ…å°ç¿»çº¢'},
            ]);

            let chartInstance = null;

            // å¤©å¤©åŸºé‡‘
            const fetchEastMoney = (code) => {
                const ts = new Date().getTime();
                const script = document.createElement('script');
                script.src = `https://fundgz.1234567.com.cn/js/${code}.js?rt=${ts}`;
                document.body.appendChild(script);
                script.onload = () => document.body.removeChild(script);
            };

            // æ–°æµªè´¢ç»
            const fetchSina = (code) => {
                const script = document.createElement('script');
                script.src = `https://hq.sinajs.cn/list=f_${code}`;
                script.onload = () => {
                    const varName = `hq_str_f_${code}`;
                    if (window[varName]) {
                        const arr = window[varName].split(',');
                        if(arr.length > 1) {
                            processFundData({
                                fundcode: code,
                                name: arr[0],
                                dwjz: arr[3], 
                                gsz: arr[1],  
                                gszzl: ((parseFloat(arr[1]) - parseFloat(arr[3])) / parseFloat(arr[3]) * 100).toFixed(2),
                                gztime: arr[4] 
                            });
                        }
                    }
                    document.body.removeChild(script);
                };
                document.body.appendChild(script);
            };

            window.jsonpgz = (data) => { processFundData(data); };

            const processFundData = (data) => {
                const target = funds.value.find(f => f.code === data.fundcode);
                if (target) {
                    target.name = data.name;
                    target.dwjz = data.dwjz;
                    target.gsz = data.gsz;
                    target.gszzl = data.gszzl;
                    recordChartData(target.code, data.gsz);
                    if (selectedFundCode.value === target.code) renderChart();
                }
            };

            const manualRefresh = () => {
                funds.value.forEach(f => {
                    if (settings.value.dataSource === 'eastmoney') fetchEastMoney(f.code);
                    else fetchSina(f.code);
                });
                lastUpdateTime.value = new Date().toLocaleTimeString();
            };

            const handleSearch = () => {
                if(searchInput.value.length < 2) { searchResults.value = []; return; }
                const ts = new Date().getTime();
                const script = document.createElement('script');
                window.FundSearchCallBack = (data) => {
                    searchResults.value = data.Datas || [];
                    document.body.removeChild(script);
                };
                script.src = `https://fundsuggest.eastmoney.com/FundSearch/api/FundSearchAPI.ashx?m=1&key=${encodeURIComponent(searchInput.value)}&callback=FundSearchCallBack&_=${ts}`;
                document.body.appendChild(script);
            };

            const addFund = (res) => {
                if (!funds.value.find(f => f.code === res.CODE)) {
                    funds.value.push({ code: res.CODE, name: res.NAME, holdAmount: 0, gszzl: "0.00", gsz: "0.00", dwjz: "--" });
                    saveData();
                    manualRefresh();
                }
                searchInput.value = ""; searchResults.value = [];
            };

            const recordChartData = (code, value) => {
                if (!chartHistory.value[code]) chartHistory.value[code] = [];
                const arr = chartHistory.value[code];
                const now = new Date();
                const timeStr = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
                if (arr.length > 0 && arr[arr.length - 1].time === timeStr) return;
                arr.push({ time: timeStr, value: value });
                if (arr.length > 200) arr.shift();
            };

            const renderChart = () => {
                if (!selectedFundCode.value) return;
                const dom = document.getElementById('mainChart');
                if (!dom) return;
                if (!chartInstance) chartInstance = echarts.init(dom, 'dark');

                const data = chartHistory.value[selectedFundCode.value] || [];
                const color = (data.length > 1 && parseFloat(data[data.length-1].value) >= parseFloat(data[0].value)) ? '#ef4444' : '#10b981';

                chartInstance.setOption({
                    backgroundColor: 'transparent',
                    grid: { top: 20, left: 10, right: 10, bottom: 40 },
                    tooltip: { trigger: 'axis' },
                    xAxis: { type: 'category', data: data.map(i=>i.time), boundaryGap: false },
                    yAxis: { type: 'value', scale: true, splitLine: { show: true, lineStyle: { color: '#334155', type:'dashed' } } },
                    dataZoom: [{ type: 'slider', height: 20, bottom: 0, borderColor: '#334155' }],
                    series: [{
                        type: 'line', data: data.map(i=>i.value), smooth: true, showSymbol: false,
                        lineStyle: { color: color, width: 2 },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0,0,0,1, [{offset:0,color:color},{offset:1,color:'transparent'}]), 
                            opacity: 0.2 
                        }
                    }]
                });
            };

            const selectFund = (fund) => {
                selectedFundCode.value = fund.code;
                nextTick(() => { 
                    if(chartInstance) chartInstance.resize(); 
                    renderChart(); 
                });
            };

            const calcProfit = (fund) => {
                if(!fund.holdAmount) return "0.00";
                return (fund.holdAmount * (parseFloat(fund.gszzl)/100)).toFixed(2);
            };

            const totalDailyProfit = computed(() => funds.value.reduce((acc, f) => acc + parseFloat(calcProfit(f)), 0).toFixed(2));
            const totalAmount = computed(() => funds.value.reduce((acc, f) => acc + (f.holdAmount || 0), 0).toFixed(2));
            const getSelectedFundName = () => funds.value.find(i => i.code === selectedFundCode.value)?.name || '';

            const saveData = () => {
                localStorage.setItem('myFundsPro_v5', JSON.stringify(funds.value));
                localStorage.setItem('mySettings_v5', JSON.stringify(settings.value));
            };
            
            const loadData = () => {
                const d = localStorage.getItem('myFundsPro_v5');
                if(d) funds.value = JSON.parse(d);
                else funds.value = [{code:'009052', name:'è¯ºå®‰æˆé•¿æ··åˆ', holdAmount: 0, gszzl: '0.00', gsz: '0.000', dwjz: '0.000'}];
                
                const s = localStorage.getItem('mySettings_v5');
                if(s) settings.value = JSON.parse(s);

                // å‡æ•°æ®å¡«å……å›¾è¡¨é˜²æ­¢ç©ºç½®
                funds.value.forEach(f => {
                    if(!chartHistory.value[f.code]) {
                        chartHistory.value[f.code] = [];
                        let base = 1.0;
                        for(let i=0; i<30; i++) {
                            base = base * (1 + (Math.random()-0.5)*0.02);
                            chartHistory.value[f.code].push({ time: `09:${i+30}`, value: base.toFixed(4) });
                        }
                    }
                });
                if(funds.value.length) selectFund(funds.value[0]);
            };

            const removeFund = (index) => {
                if(confirm("åˆ é™¤è¯¥åŸºé‡‘ï¼Ÿ")) {
                    funds.value.splice(index, 1);
                    if(funds.value.length === 0) selectedFundCode.value = null;
                    saveData();
                }
            };
            
            const togglePrivacy = () => { settings.value.privacyMode = !settings.value.privacyMode; saveData(); };

            onMounted(() => {
                // *** æ ¸å¿ƒä¿®å¤ï¼šVue æŒ‚è½½åï¼Œå¼ºåˆ¶å…³é—­åŠ è½½åŠ¨ç”» ***
                const loading = document.getElementById('loading');
                if(loading) loading.style.display = 'none';
                
                const appDiv = document.getElementById('app');
                if(appDiv) appDiv.style.display = 'block';

                loadData();
                manualRefresh();
                setInterval(manualRefresh, 5000);
                window.addEventListener('resize', () => chartInstance && chartInstance.resize());
            });

            return {
                funds, searchInput, searchResults, selectedFundCode, lastUpdateTime, settings, showSettings, newsList,
                handleSearch, addFund, removeFund, selectFund, manualRefresh, togglePrivacy, saveData, calcProfit, 
                totalDailyProfit, totalAmount, getSelectedFundName
            };
        }
    }).mount('#app');
</script>
</body>
</html>
